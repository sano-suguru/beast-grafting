# Beast Binding Arena - Copilot Instructions

## プロジェクト概要

GitHub Issue で魔獣を登録し、AI が闘技場でバトル描写を生成するヘッドレスゲーム。

詳細は `docs/` を参照:
- `docs/01-REQUIREMENTS.md` — 要件定義、スコープ（骨/肉/皮）、設計原則
- `docs/02-SPECIFICATION.md` — 詳細仕様
- `docs/03-ARCHITECTURE.md` — 技術スタック、ディレクトリ構成、データ形式

## 基本姿勢

- **推測・創作禁止** — 仕様・設計・制約について推測や創作をしない。不明点は `docs/` を読んで確認する
- **実装前に docs/ を読む** — 新機能の実装や既存機能の変更前に、関連する docs/ のセクションを必ず確認する

## 技術選定方針

- **標準ツール優先** — カスタムスクリプトより業界標準のツール（ESLint, Prettier等）を採用
- **エコシステム活用** — 既存のプラグイン・設定を活用し、独自実装を最小化
- **neverthrow** — エラーハンドリングは Result 型で統一、try-catch/throw は ESLint で禁止

## コード品質

- **ボーイスカウトルール** — 触れたコードは見つけた時より綺麗にして去る
- **ペーパーカット修正** — タイポ、不明瞭な命名、古いコメント、不要な import は見つけ次第修正
- **TODO解消** — 簡単に解決できる TODO コメントはその場で対応
- **デッドコード禁止** — 未使用の変数・関数・クラス、コメントアウト、到達不能コードは残さない
- **後方互換の残骸禁止** — 「後方互換のため」「削除予定」を理由にデッドコードを残さない。不要になったコードは即削除

## 実装方針

1. **スコープを意識** — `docs/01-REQUIREMENTS.md` に骨/肉/皮の定義がある。ユーザーが指定しない限り、未実装機能は骨→肉→皮の順で優先
2. **拡張ポイントを意識した設計** — 将来の機能追加を妨げない構造にする
3. **両立させる** — スコープを絞っても拡張性は犠牲にしない。技術的負債を残さない設計で実装する

## コーディング規約

- スキーマは `src/schemas/` に Zod で定義、型は推論で取得
- バリデーションエラーは Zod の parse で処理
- front matter 付き Markdown は `gray-matter` で読み書き
- テストは `tests/` に配置、Vitest で実行

### エラーハンドリング

- **try-catch/throw 禁止** — ESLint ルール `no-restricted-syntax` で禁止済み
- **neverthrow を使用** — すべてのエラーは `Result` / `ResultAsync` 型で表現する
- **外部コードのラップ** — 例外を投げる外部ライブラリは `Result.fromThrowable()` または `ResultAsync.fromPromise()` でラップする
- **エラー伝播** — `result.isErr()` でチェックし、早期リターンで伝播する

## ターミナル操作ルール

- **gh CLI** — `GH_PAGER='' gh ...` の形式で実行する。PAGER を無効化しないと出力をキャプチャできない

## ファイル操作ルール

**コマンドを優先すべきファイル**（直接編集しない）:

- `package.json` → `npm init`, `npm pkg set`, `npm install`
- `tsconfig.json` → `npx tsc --init`
- ロックファイル → 自動生成に任せる

**直接編集してよいファイル**:

- `src/` 配下のソースコード
- `docs/` 配下のドキュメント
- `.github/workflows/` のワークフロー定義
